<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>High End CU - Member Enrollment</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>
  <style>
    :root {
      --primary-blue: #00447C;
      --secondary-blue: #0066A1;
      --accent-gold: #C5A047;
      --off-white: #F8F9FC;
      --slate-gray: #4A5C6C;
    }

    body {
      background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
      min-height: 100vh;
      color: var(--off-white);
      font-family: 'Arial', sans-serif;
      margin: 0;
      padding: 0;
    }

    .header {
      background-color: var(--off-white);
      padding: 1rem;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .brand-title {
      color: var(--primary-blue) !important;
      font-weight: 700;
      font-size: 1.8rem;
    }

    .motto {
      color: var(--secondary-blue);
      font-style: italic;
      font-size: 0.9rem;
    }

    .auth-card {
      background: rgba(0, 68, 124, 0.95);
      border-radius: 15px;
      padding: 2rem;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
      width: 100%;
      max-width: 960px;
      margin: 2rem auto;
      border: 1px solid rgba(197, 160, 71, 0.3);
    }

    .auth-header {
      color: var(--accent-gold);
      font-weight: 600;
      margin-bottom: 1.5rem;
    }

    .progress-steps {
      display: flex;
      justify-content: space-between;
      margin-bottom: 2rem;
    }

    .step {
      text-align: center;
      flex: 1;
      color: var(--off-white);
    }

    .step-number {
      background: rgba(248, 249, 252, 0.2);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      margin: 0 auto 0.5rem;
      line-height: 40px;
    }

    .step.active .step-number {
      background: var(--accent-gold);
      color: var(--primary-blue);
    }

    .form-section {
      display: none;
    }

    .form-section.active {
      display: block;
    }

    .account-selector {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.2rem;
      margin: 2rem 0;
    }

    .account-card {
      background: rgba(248, 249, 252, 0.1);
      border: 2px solid transparent;
      border-radius: 12px;
      padding: 1.5rem 1rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .account-card:hover {
      background: rgba(248, 249, 252, 0.15);
      transform: translateY(-3px);
    }

    .account-card.selected {
      border-color: var(--accent-gold);
      background: rgba(197, 160, 71, 0.1);
    }

    .account-card i {
      font-size: 2rem;
      color: var(--accent-gold);
      margin-bottom: 0.75rem;
    }

    .form-control, .form-select {
      background: rgba(248, 249, 252, 0.1) !important;
      border: 1px solid rgba(248, 249, 252, 0.3) !important;
      border-radius: 8px;
      padding: 0.8rem;
      color: var(--off-white) !important;
    }

    .form-control:focus, .form-select:focus {
      border-color: var(--accent-gold) !important;
      box-shadow: 0 0 0 3px rgba(197, 160, 71, 0.2) !important;
    }

    .btn-primary {
      background: var(--accent-gold);
      color: var(--primary-blue);
      border: none;
      padding: 0.75rem 1.5rem;
      font-weight: 600;
    }

    .dual-citizenship-group {
      border-left: 3px solid var(--accent-gold);
      padding-left: 1rem;
      margin: 1rem 0;
    }

    .bottom-links {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 3rem 2rem;
      margin-top: 4rem;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 2rem;
    }

    .bottom-links h5 {
      color: var(--accent-gold);
      border-bottom: 2px solid var(--accent-gold);
      padding-bottom: 0.75rem;
      margin-bottom: 1rem;
      font-size: 1.25rem;
    }

    .bottom-links p, .bottom-links a {
      color: var(--off-white);
      text-decoration: none;
      margin: 0.5rem 0;
    }

    @media (max-width: 768px) {
      .auth-card {
        padding: 1rem;
      }
      .account-card {
        padding: 1rem 0.5rem;
      }
    }
  </style>
</head>
<body>
<!-- Header -->
<div class="header">
  <div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center flex-wrap">
      <div>
        <span class="brand-title">High End Credit Union</span>
        <span class="motto d-block mt-1">Your Financial Success, Our Priority</span>
      </div>
      <a href="index.html" class="btn btn-outline-primary mt-2 mt-md-0">
        <i class="fas fa-home me-2"></i> Home
      </a>
      </div>
    </div>
  </div>

  <!-- Main Form Container -->
  <div class="container">
    <div class="auth-card">
      <!-- Progress Steps -->
      <div class="progress-steps">
        <div class="step active"><div class="step-number">1</div>Select Account</div>
        <div class="step"><div class="step-number">2</div>Personal Info</div>
        <div class="step"><div class="step-number">3</div>Review</div>
        <div class="step"><div class="step-number">4</div>Email Verify</div>
        <div class="step"><div class="step-number">5</div>Credentials</div>
      </div>

      <!-- Step 1: Account Selection -->
      <div class="form-section active" id="accountSelection">
        <h2 class="auth-header text-center">Select Financial Products</h2>
        <div class="account-selector">
          <div class="account-card" data-account="platinum-checking">
            <i class="fas fa-wallet"></i>
            <h5>Platinum Checking</h5>
            <p>2.15% APY • No Fees</p>
          </div>
          <div class="account-card" data-account="high-savings">
            <i class="fas fa-piggy-bank"></i>
            <h5>High-Yield Savings</h5>
            <p>3.75% APY • FDIC Insured</p>
          </div>
          <div class="account-card" data-account="cd">
            <i class="fas fa-certificate"></i>
            <h5>Certificates of Deposit</h5>
            <p>Fixed Term • High APY</p>
          </div>
          <div class="account-card" data-account="ira">
            <i class="fas fa-user-shield"></i>
            <h5>IRA Accounts</h5>
            <p>Tax Benefits • Retirement</p>
          </div>
          <div class="account-card" data-account="mortgage">
            <i class="fas fa-home"></i>
            <h5>Mortgages</h5>
            <p>Competitive Rates</p>
          </div>
          <div class="account-card" data-account="auto-loan">
            <i class="fas fa-car"></i>
            <h5>Auto Loans</h5>
            <p>Fast Approval</p>
          </div>
          <div class="account-card" data-account="personal-loan">
            <i class="fas fa-hand-holding-usd"></i>
            <h5>Personal Loans</h5>
            <p>Flexible Terms</p>
          </div>
        </div>
        <div class="text-center mt-4">
          <button class="btn btn-primary" onclick="validateAccountSelection()">
            Continue <i class="fas fa-arrow-right ms-2"></i>
          </button>
        </div>
      </div>

      <!-- Step 2: Personal Information -->
      <div class="form-section" id="personalInfo">
        <h2 class="auth-header text-center">Personal Information</h2>
        <form id="personalInfoForm" novalidate>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">First Name *</label>
              <input type="text" class="form-control" id="firstName" required>
              <div class="invalid-feedback">Please enter your first name</div>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Last Name *</label>
              <input type="text" class="form-control" id="lastName" required>
              <div class="invalid-feedback">Please enter your last name</div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Social Security Number (SSN) *</label>
              <input type="text" class="form-control" id="ssn" pattern="\d{3}-\d{2}-\d{4}" placeholder="XXX-XX-XXXX" required>
              <div class="invalid-feedback">Valid SSN required (XXX-XX-XXXX)</div>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Date of Birth *</label>
              <div class="row g-2">
                <div class="col-4">
                  <select class="form-select" id="birthMonth" required>
                    <option value="">Month</option>
                  </select>
                </div>
                <div class="col-4">
                  <select class="form-select" id="birthDay" required>
                    <option value="">Day</option>
                  </select>
                </div>
                <div class="col-4">
                  <select class="form-select" id="birthYear" required>
                    <option value="">Year</option>
                  </select>
                </div>
              </div>
              <div class="invalid-feedback">Please select a valid date</div>
            </div>
          </div>
          <div class="row">
            <div class="col-12 mb-3">
              <label class="form-label">Street Address *</label>
              <input type="text" class="form-control" id="street" required>
              <div class="invalid-feedback">Please enter your street address</div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">City *</label>
              <input type="text" class="form-control" id="city" required>
              <div class="invalid-feedback">Please enter your city</div>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Zip Code *</label>
              <input type="text" class="form-control" id="zip" required>
              <div class="invalid-feedback">Please enter your zip code</div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Country *</label>
              <select class="form-select" id="country" required>
                <option value="">Select Country</option>
                <option value="US">United States</option>
                <option value="CA">Canada</option>
                <option value="GB">United Kingdom</option>
              </select>
              <div class="invalid-feedback">Please select a country</div>
            </div>
            <div class="col-md-6 mb-3" id="stateField" style="display: none;">
              <label class="form-label">State *</label>
              <select class="form-select" id="state">
                <option value="">Select State</option>
              </select>
              <div class="invalid-feedback">Please select a state</div>
            </div>
          </div>
          <div class="dual-citizenship-group mb-3">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="dualCitizenship">
              <label class="form-check-label" for="dualCitizenship">
                I hold dual citizenship
              </label>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Email Address *</label>
              <input type="email" class="form-control" id="email" required>
              <div class="invalid-feedback">Please enter a valid email</div>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Phone Number *</label>
              <input type="tel" class="form-control" id="phone" pattern="[0-9]{3}-[0-9]{3}-[0-9]{4}" placeholder="XXX-XXX-XXXX" required>
              <div class="invalid-feedback">Please enter a valid phone number</div>
            </div>
          </div>
          <div class="text-center mt-3">
            <button class="btn btn-outline-primary me-3" type="button" onclick="showPreviousSection()">
              <i class="fas fa-arrow-left me-2"></i>Back
            </button>
            <button class="btn btn-primary" type="button" onclick="validatePersonalInfo()">
              Continue <i class="fas fa-arrow-right ms-2"></i>
            </button>
          </div>
        </form>
      </div>

      <!-- Step 3: Review & Submit -->
      <div class="form-section" id="reviewSubmit">
        <h2 class="auth-header text-center">Review & Submit</h2>
        <div class="mb-3">
          <h5>Selected Accounts:</h5>
          <ul id="selectedAccountsList"></ul>
        </div>
        <div class="mb-3">
          <h5>Personal Information:</h5>
          <div id="personalInfoReview"></div>
        </div>
        <div class="form-check mb-3">
          <input class="form-check-input" type="checkbox" id="termsCheck" required>
          <label class="form-check-label" for="termsCheck">
            I agree to the <a href="#">Terms</a> and <a href="#">Privacy Policy</a>
          </label>
        </div>
        <div class="text-center">
          <button class="btn btn-outline-primary me-3" onclick="showPreviousSection()">
            <i class="fas fa-arrow-left me-2"></i>Back
          </button>
          <button class="btn btn-primary" onclick="submitApplication()">
            Submit Application <i class="fas fa-check ms-2"></i>
          </button>
        </div>
      </div>

      <!-- Step 4: Email Verification -->
      <div class="form-section" id="emailVerification">
        <div class="text-center py-5">
          <i class="fas fa-envelope fa-3x mb-3"></i>
          <h3>Check Your Email</h3>
          <p>We've sent a verification link to <strong id="userEmail"></strong>.</p>
          <div class="alert alert-success mt-4">
            <i class="fas fa-check-circle me-2"></i>Email Verified!
          </div>
          <button class="btn btn-primary" onclick="showNextSection('credentials')">
            Continue to Login Setup
          </button>
        </div>
      </div>

  <!-- Step 5: Credentials Setup -->
  <div class="form-section" id="credentials">
    <h2 class="auth-header text-center">Create Login Credentials</h2>
    <form id="credentialForm" novalidate>
      <div class="mb-3">
        <label class="form-label">Username *</label>
        <input type="text" class="form-control" id="username" required>
              <div class="invalid-feedback">Please choose a username</div>
              </div>
              <div class="mb-3">
                <label class="form-label">Password *</label>
                <input type="password" class="form-control" id="password" required>
               <div class="invalid-feedback">
                Password must be at least 8 characters
                </div>
             </div>
          </div>
          <div class="text-center">
            <button class="btn btn-outline-primary me-3" type="button" onclick="showPreviousSection()">
              <i class="fas fa-arrow-left me-2"></i>Back
            </button>
            <button class="btn btn-primary" type="button" onclick="completeSetup()">
              Complete Setup <i class="fas fa-check ms-2"></i>
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Bottom Links -->
    <div class="bottom-links">
      <div>
        <h5>Banking Services</h5>
        <p>Checking Accounts</p>
        <p>Savings Accounts</p>
        <p>Credit Cards</p>
        <p>Loans</p>
        <p>Mortgages</p>
      </div>
      <div>
        <h5>Digital Banking</h5>
        <p>Mobile Banking</p>
        <p>Online Bill Pay</p>
        <p>Zelle Payments</p>
        <p>Wire Transfers</p>
        <p>Account Alerts</p>
      </div>
      <div>
        <h5>About Us</h5>
        <p>Our History</p>
        <p>Leadership</p>
        <p>Careers</p>
        <p>Investor Relations</p>
        <p>Community</p>
      </div>
      <div>
        <h5>Support</h5>
        <p>Contact Us</p>
        <p>Branch Locator</p>
        <p>ATM Network</p>
        <p>FAQs</p>
        <p>Security Center</p>
      </div>
      <div>
        <h5>Legal</h5>
        <p>Privacy Policy</p>
        <p>Terms of Service</p>
        <p>Disclosures</p>
        <p>Accessibility</p>
        <p>Regulatory Info</p>
      </div>
    </div>
  </div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
  let currentSection = 0;
  let selectedAccounts = [];

  document.addEventListener('DOMContentLoaded', function () {
    const monthSelect = document.getElementById('birthMonth');
    const daySelect = document.getElementById('birthDay');
    const yearSelect = document.getElementById('birthYear');

    const months = ['January','February','March','April','May','June',
                    'July','August','September','October','November','December'];
    months.forEach((month, index) => {
      monthSelect.innerHTML += `<option value="${index + 1}">${month}</option>`;
    });
    for (let i = 1; i <= 31; i++) {
      daySelect.innerHTML += `<option value="${i}">${i}</option>`;
    }
    const currentYear = new Date().getFullYear();
    for (let i = currentYear - 18; i >= 1900; i--) {
      yearSelect.innerHTML += `<option value="${i}">${i}</option>`;
    }

    // Country-State toggle
    const countrySelect = document.getElementById('country');
    const stateField = document.getElementById('stateField');
    const stateSelect = document.getElementById('state');
    countrySelect.addEventListener('change', function () {
      if (this.value === 'US') {
        stateField.style.display = 'block';
        stateSelect.required = true;
      } else {
        stateField.style.display = 'none';
        stateSelect.required = false;
      }
    });
    const states = ["AL","AK","AZ","AR","CA","CO","CT","DE","FL","GA",
                    "HI","ID","IL","IN","IA","KS","KY","LA","ME","MD",
                    "MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ",
                    "NM","NY","NC","ND","OH","OK","OR","PA","RI","SC",
                    "SD","TN","TX","UT","VT","VA","WA","WV","WI","WY"];
    states.forEach(state => {
      stateSelect.innerHTML += `<option value="${state}">${state}</option>`;
    });
  });

  function showNextSection(id) {
    const sections = document.querySelectorAll('.form-section');
    sections.forEach(sec => sec.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    currentSection++;
  }

  function showPreviousSection() {
    const sections = document.querySelectorAll('.form-section');
    sections.forEach(sec => sec.classList.remove('active'));
    if (currentSection > 0) currentSection--;
    sections[currentSection].classList.add('active');
  }

  function validateAccountSelection() {
    const selected = document.querySelectorAll('.account-card.selected');
    if (selected.length === 0) {
      alert('Please select at least one account type.');
      return;
    }
    selectedAccounts = Array.from(selected).map(card => card.dataset.account);
    showNextSection('personalInfo');
  }

  function validatePersonalInfo() {
    const form = document.getElementById('personalInfoForm');
    if (!form.checkValidity()) {
      form.classList.add('was-validated');
      return;
    }
    showNextSection('reviewSubmit');
    document.getElementById('selectedAccountsList').innerHTML =
      selectedAccounts.map(acc => `<li>${acc.replace(/-/g, ' ')}</li>`).join('');
    document.getElementById('personalInfoReview').innerHTML = `
      <p><strong>Name:</strong> ${document.getElementById('firstName').value} ${document.getElementById('lastName').value}</p>
      <p><strong>SSN:</strong> ${document.getElementById('ssn').value}</p>
      <p><strong>DOB:</strong> ${document.getElementById('birthMonth').value}/${document.getElementById('birthDay').value}/${document.getElementById('birthYear').value}</p>
      <p><strong>Address:</strong> ${document.getElementById('street').value}, ${document.getElementById('city').value}, ${document.getElementById('zip').value}, ${document.getElementById('country').value} ${document.getElementById('state').value || ''}</p>
      <p><strong>Email:</strong> ${document.getElementById('email').value}</p>
      <p><strong>Phone:</strong> ${document.getElementById('phone').value}</p>
      <p><strong>Dual Citizenship:</strong> ${document.getElementById('dualCitizenship').checked ? 'Yes' : 'No'}</p>
    `;
  }

  function submitApplication() {
    if (!document.getElementById('termsCheck').checked) {
      alert('Please agree to the Terms and Privacy Policy');
      return;
    }
    document.getElementById('userEmail').textContent = document.getElementById('email').value;
    showNextSection('emailVerification');
  }

  function completeSetup() {
    const form = document.getElementById('credentialForm');
    if (!form.checkValidity()) {
      form.classList.add('was-validated');
      return;
    }

    const name = document.getElementById('firstName').value + " " + document.getElementById('lastName').value;
    const email = document.getElementById('email').value;
    // CORRECTED LINE: Changed 'newPassword' to 'password'
    const password = document.getElementById('password').value;
    const accountTypes = selectedAccounts.length > 0 ? selectedAccounts : ['checking'];
    const balance = 0;
	
	// Replace the entire form submit handler with:
document.getElementById('loginForm').addEventListener('submit', function(e) {
  e.preventDefault();
  const email = document.getElementById('usernameInput').value;
  const password = document.getElementById('passwordInput').value;

  fetch('/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email, password })
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      localStorage.setItem('loggedInUser', JSON.stringify(data.user));
      window.location.href = '/user-dashboard';
    } else {
      alert('Invalid email or password!');
    }
  })
  .catch(err => {
    console.error('Login error:', err);
    alert('Login failed. Please try again.');
  });
});

// Update admin PIN handler
document.getElementById('submitPin').addEventListener('click', function() {
  const pinInput = document.getElementById('adminPin'));
  if (pinInput.value === '123456789') {
    window.location.href = '/admin-dashboard';
  } else {
    pinInput.classList.add('is-invalid');
  }
});

fetch('/register', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ 
    name: document.getElementById('firstName').value + " " + document.getElementById('lastName').value,
    email: document.getElementById('email').value,
    password: document.getElementById('password').value,
    accountTypes: selectedAccounts 
  })
})
.then(res => res.json())
.then(data => {
  if (data.success) {
    localStorage.setItem('loggedInUser', JSON.stringify(data.user));
    window.location.href = data.redirect;
  } else {
    alert(data.message || 'Registration failed. Try again.');
  }
})
.catch(err => {
  console.error('Error:', err);
  alert('Something went wrong.');
});

  // Toggle account card selection
  document.querySelectorAll('.account-card').forEach(card => {
    card.addEventListener('click', function () {
      this.classList.toggle('selected');
    });
  });
</script>
</body>
</html>

